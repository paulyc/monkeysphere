From 321b5dca3604699a1abd8e60cfcf196b005f60c7 Mon Sep 17 00:00:00 2001
From: Daniel Kahn Gillmor <dkg@fifthhorseman.net>
Date: Tue, 5 May 2015 12:11:00 -0400
Subject: [PATCH 2/2] fix diagnostic check and recommendation for good
 authorizedkeysfile in sshd_config

---
 src/share/ma/diagnostics | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/share/ma/diagnostics b/src/share/ma/diagnostics
index abf207e..a59244a 100644
--- a/src/share/ma/diagnostics
+++ b/src/share/ma/diagnostics
@@ -122,9 +122,9 @@ echo "Checking for Monkeysphere-enabled public-key authentication for users ..."
 # Ensure that User ID authentication is enabled:
 if echo "AuthorizedKeysFile foo bar" | /usr/sbin/sshd -t -f /dev/stdin; then
     # OpenSSH >= 6.0, multiple authorized_keys file supported
-    if ! grep -q "^AuthorizedKeysFile[[:space:]]\+.*[[:space:]]\*${SYSDATADIR}/authorized_keys/%u$" "$sshd_config"; then
+    if ! grep -q "^AuthorizedKeysFile[[:space:]]\+.*[[:space:]]*${SYSDATADIR}/authorized_keys/%u$" "$sshd_config"; then
         echo "! $sshd_config does not point to monkeysphere authorized keys."
-        echo " - Recommendation: add a line to $sshd_config: 'AuthorizedKeysFile .ssh/authorized_keys .ssh/authorized_keys2 ${SYSDATADIR}/authorized_keys/%u'"
+        echo " - Recommendation: add a line to $sshd_config: 'AuthorizedKeysFile %h/.ssh/authorized_keys %h/.ssh/authorized_keys2 ${SYSDATADIR}/authorized_keys/%u'"
         problemsfound=$(($problemsfound+1))
     fi
     if [ "$RAW_AUTHORIZED_KEYS" != none ]; then
-- 
2.1.4

